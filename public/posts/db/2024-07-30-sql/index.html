<!DOCTYPE html>
<html lang="en">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=56857&amp;path=livereload" data-no-instant defer></script>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<style type=text/css>body{font-family:monospace;}</style>
	<title>Sql</title>
	
	
	<link rel="stylesheet" href="/css/style.css">
	
	
</head>
<body>
	<header>
	===========================<br>
	== <a href="//localhost:56857/">Houze ZHANG 张厚泽</a> ==<br>
	===========================
	<div style="float: right;">Software Engineer at Google</div><br>
	<p>
	<nav>
			<a href="/"><b>Start</b></a>.
			
			
			<a href="/posts/"><b>Posts</b></a>.
			
			<a href="/categories/"><b>Categories</b></a>.
			
			<a href="/tags/"><b>Tags</b></a>.
			
			<a href="/projects/"><b>Projects</b></a>.
			
	</nav>
	</p>
	
</header>

	
	<main>
		<article>
			<h1>Sql</h1>
			<b><time>30.07.2024 18:07</time></b>
		       
		           <a href="/tags/sql">SQL</a>
        	       
		           <a href="/tags/database">Database</a>
        	       

			<div>
				<h2 id="introduction">Introduction</h2>
<p>The SQL language is used to access and manipulate databases. SQL is an ANSI (American National Standards Institute) standard language, but there are many different versions of the SQL language.</p>
<p>The aim of this article is to provide a comprehensive guide to SQL and serve as a reference for SQL queries. The majority of the examples are from LeetCode.</p>
<hr>
<h2 id="representation">Representation</h2>
<h3 id="rename-table">Rename Table</h3>
<p>Use <code>select</code> to rename table.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">select</span> (...) <span style="color:#66d9ef">as</span> (...);
</span></span></code></pre></div><h3 id="rename-field">Rename Field</h3>
<p>Use <code>select</code> to rename field.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">select</span> S <span style="color:#66d9ef">as</span> <span style="color:#66d9ef">New</span> <span style="color:#66d9ef">from</span> <span style="color:#66d9ef">table</span>;
</span></span></code></pre></div><h3 id="filter-fields">Filter Fields</h3>
<p>Use <code>select</code> to filter fields.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">select</span> S1, S2, S3, ... <span style="color:#66d9ef">from</span> <span style="color:#66d9ef">table</span>;
</span></span></code></pre></div><hr>
<h2 id="field-type">Field Type</h2>
<h3 id="enum-type">Enum Type</h3>
<p>Use <code>=</code> to compare enum type.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> <span style="color:#66d9ef">table</span> <span style="color:#66d9ef">where</span> tp <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;A&#39;</span>;
</span></span></code></pre></div><h3 id="null-type">NULL Type</h3>
<p>Use <code>is null</code> to compare null type.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> <span style="color:#66d9ef">table</span> <span style="color:#66d9ef">where</span> tp <span style="color:#66d9ef">is</span> <span style="color:#66d9ef">null</span>;
</span></span></code></pre></div><h3 id="not-null-type">NOT NULL Type</h3>
<p>Use <code>is not null</code> to compare not null type.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> <span style="color:#66d9ef">table</span> <span style="color:#66d9ef">where</span> tp <span style="color:#66d9ef">is</span> <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span>;
</span></span></code></pre></div><h3 id="or-logic">OR Logic</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">select</span> name <span style="color:#66d9ef">from</span> Customer
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">where</span> referee_id <span style="color:#66d9ef">is</span> <span style="color:#66d9ef">null</span> <span style="color:#66d9ef">or</span> referee_id <span style="color:#f92672">!=</span> <span style="color:#ae81ff">2</span>
</span></span></code></pre></div><h2 id="top-n-from-x-offset-second-highest-salary">Top N from X offset (Second Highest Salary)</h2>
<p>Use <code>limit</code> to get top N from X offset.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> <span style="color:#66d9ef">table</span> <span style="color:#66d9ef">order</span> <span style="color:#66d9ef">by</span> S <span style="color:#66d9ef">desc</span> <span style="color:#66d9ef">limit</span> N <span style="color:#66d9ef">offset</span> X;
</span></span></code></pre></div><h2 id="math">Math</h2>
<h3 id="round"><code>round()</code></h3>
<p>Use <code>round()</code> to round numbers.</p>
<p>Keep 3 decimal places.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">select</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>a.machine_id <span style="color:#66d9ef">as</span> machine_id, round(<span style="color:#66d9ef">avg</span>(b.<span style="color:#66d9ef">timestamp</span> <span style="color:#f92672">-</span> a.<span style="color:#66d9ef">timestamp</span>), <span style="color:#ae81ff">3</span>) <span style="color:#66d9ef">as</span> processing_time
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">from</span> Activity <span style="color:#66d9ef">as</span> a
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">join</span> Activity <span style="color:#66d9ef">as</span> b
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">on</span> a.activity_type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;start&#39;</span> <span style="color:#66d9ef">and</span> b.activity_type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;end&#39;</span> <span style="color:#66d9ef">and</span> a.machine_id <span style="color:#f92672">=</span> b.machine_id <span style="color:#66d9ef">and</span> a.process_id <span style="color:#f92672">=</span> b.process_id
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">group</span> <span style="color:#66d9ef">by</span> machine_id
</span></span></code></pre></div><h2 id="aggregation-and-grouping">Aggregation and Grouping</h2>
<h3 id="group-by">Group By</h3>
<p>Use <code>group by</code> to group by fields.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">select</span> S1, S2, ... <span style="color:#66d9ef">from</span> <span style="color:#66d9ef">table</span> <span style="color:#66d9ef">group</span> <span style="color:#66d9ef">by</span> S1, S2, ...;
</span></span></code></pre></div><h3 id="having">Having</h3>
<p>Use <code>having</code> to filter groups.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">select</span> S1, S2, ... <span style="color:#66d9ef">from</span> <span style="color:#66d9ef">table</span> <span style="color:#66d9ef">group</span> <span style="color:#66d9ef">by</span> S1, S2, ... <span style="color:#66d9ef">having</span> S1 <span style="color:#f92672">&gt;</span> N;
</span></span></code></pre></div><h3 id="count">Count</h3>
<p>Use <code>count</code> to count fields.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">select</span> <span style="color:#66d9ef">count</span>(S) <span style="color:#66d9ef">from</span> <span style="color:#66d9ef">table</span>;
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">select</span> S1, <span style="color:#66d9ef">count</span>(S2) <span style="color:#66d9ef">from</span> <span style="color:#66d9ef">table</span> <span style="color:#66d9ef">group</span> <span style="color:#66d9ef">by</span> S1;
</span></span></code></pre></div><h3 id="sum">Sum</h3>
<p>Use <code>sum</code> to sum fields.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">select</span> <span style="color:#66d9ef">sum</span>(S) <span style="color:#66d9ef">from</span> <span style="color:#66d9ef">table</span>;
</span></span></code></pre></div><p>After <code>group by</code>, <code>select</code> can only contain fields in <code>group by</code> or aggregation functions.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">select</span> S1, <span style="color:#66d9ef">sum</span>(S2) <span style="color:#66d9ef">from</span> <span style="color:#66d9ef">table</span> <span style="color:#66d9ef">group</span> <span style="color:#66d9ef">by</span> S1;
</span></span></code></pre></div><h2 id="subquery-find-managers-with-at-least-5-direct-reports">SubQuery (Find Managers with at least 5 Direct Reports)</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span> <span style="color:#66d9ef">select</span> name <span style="color:#66d9ef">from</span> employee <span style="color:#66d9ef">where</span> id <span style="color:#66d9ef">in</span> 
</span></span><span style="display:flex;"><span> (<span style="color:#66d9ef">select</span> managerId <span style="color:#66d9ef">from</span> (<span style="color:#66d9ef">select</span> id,managerId,name,<span style="color:#66d9ef">COUNT</span>(id) <span style="color:#66d9ef">as</span> number_of_report <span style="color:#66d9ef">from</span> Employee <span style="color:#66d9ef">group</span> <span style="color:#66d9ef">by</span> managerId ) <span style="color:#66d9ef">as</span> <span style="color:#66d9ef">New</span> <span style="color:#66d9ef">where</span> <span style="color:#66d9ef">New</span>.number_of_report<span style="color:#f92672">&gt;=</span><span style="color:#ae81ff">5</span>)
</span></span></code></pre></div><h2 id="join">Join</h2>
<h3 id="inner-join">Inner Join</h3>
<p><a href="https://leetcode.com/problems/employees-earning-more-than-their-managers/">https://leetcode.com/problems/employees-earning-more-than-their-managers/</a></p>
<p>Use <code>join</code> + <code>on</code> to join tables.</p>
<p>If the condition is not met, the record will not be displayed.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">select</span> a.name <span style="color:#66d9ef">as</span> Employee
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">from</span> Employee <span style="color:#66d9ef">as</span> a
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">join</span> Employee <span style="color:#66d9ef">as</span> b
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">on</span> a.managerId <span style="color:#f92672">=</span> b.id
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">where</span> a.salary <span style="color:#f92672">&gt;</span> b.salary
</span></span></code></pre></div><h3 id="outer-join">Outer Join</h3>
<p><a href="https://leetcode.com/problems/combine-two-tables/">https://leetcode.com/problems/combine-two-tables/</a></p>
<p>Use <code>left join</code> or <code>right join</code> to outer join tables.</p>
<p>The aim of outer join is to keep all records in the left table. If there is no match in the right table, the result is <code>null</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">select</span> a.name <span style="color:#66d9ef">as</span> Employee
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">from</span> Employee <span style="color:#66d9ef">as</span> a
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">left</span> <span style="color:#66d9ef">join</span> Employee <span style="color:#66d9ef">as</span> b
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">on</span> a.managerId <span style="color:#f92672">=</span> b.id
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">where</span> a.salary <span style="color:#f92672">&gt;</span> b.salary
</span></span></code></pre></div><hr>
<h2 id="date-and-time">Date and Time</h2>
<h3 id="date">Date</h3>
<h4 id="add_date"><code>add_date()</code></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">Select</span> w1.id <span style="color:#66d9ef">from</span> Weather w1 <span style="color:#66d9ef">join</span> Weather w2 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">on</span> w1.recordDate <span style="color:#f92672">=</span> date_add(w2.recordDate, interval <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">day</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">where</span> w1.temperature <span style="color:#f92672">&gt;</span> w2.temperature;
</span></span></code></pre></div><hr>
<h2 id="window-function">Window Function</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#75715e">-- Select the department name, employee name, and salary
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> 
</span></span><span style="display:flex;"><span>    d.name <span style="color:#66d9ef">AS</span> Department, 
</span></span><span style="display:flex;"><span>    emp.name <span style="color:#66d9ef">AS</span> Employee, 
</span></span><span style="display:flex;"><span>    emp.salary 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">-- Select all columns from employee and add a rank based on salary within each department
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">SELECT</span> 
</span></span><span style="display:flex;"><span>        employee.<span style="color:#f92672">*</span>, 
</span></span><span style="display:flex;"><span>        DENSE_RANK() OVER (PARTITION <span style="color:#66d9ef">BY</span> departmentid <span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> salary <span style="color:#66d9ef">DESC</span>) <span style="color:#66d9ef">AS</span> rnk 
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">FROM</span> 
</span></span><span style="display:flex;"><span>        employee
</span></span><span style="display:flex;"><span>) <span style="color:#66d9ef">AS</span> emp
</span></span><span style="display:flex;"><span><span style="color:#75715e">-- Join the department table to get the department name
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">LEFT</span> <span style="color:#66d9ef">JOIN</span> 
</span></span><span style="display:flex;"><span>    department <span style="color:#66d9ef">AS</span> d 
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">ON</span> d.id <span style="color:#f92672">=</span> emp.departmentid
</span></span><span style="display:flex;"><span><span style="color:#75715e">-- Filter to get only the top 3 salaries per department
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">WHERE</span> 
</span></span><span style="display:flex;"><span>    emp.rnk <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">3</span>;
</span></span></code></pre></div><h3 id="dense-rank-rank-and-row-number">Dense Rank, Rank, and Row Number</h3>
<ul>
<li><code>DENSE_RANK()</code>: Returns the rank of rows within the partition of a result set, without any gaps in the ranking.</li>
<li><code>RANK()</code>: Returns the rank of rows within the partition of a result set, with gaps in the ranking where there are ties.</li>
<li><code>ROW_NUMBER()</code>: Returns a unique number for each row starting from 1.</li>
</ul>

			</div>
		</article>
	</main>
<aside>
	<div>
		<div>
			<h3>LATEST POSTS</h3>
		</div>
		<div>
			<ul>
				
				<li><a href="/posts/rust/rust64/2025-12-18-l1/">Rust from scratch L1: Hello world, variables, scalars and compound types</a></li>
				
				<li><a href="/posts/algo/dp/2024-07-31-longest-increasing-subsequence/">Longest Increasing Subsequence</a></li>
				
				<li><a href="/posts/db/2024-07-30-sql/">Sql</a></li>
				
				<li><a href="/posts/mit-s6.081/xv6-2/">Xv6-Lab-2</a></li>
				
				<li><a href="/posts/mit-s6.081/xv6-1/">Xv6-Lab-1</a></li>
				
			</ul>
		</div>
	</div>
</aside>


	<footer>
	<p>&copy; 2025 <a href="//localhost:56857/"><b>Houze ZHANG 张厚泽</b></a>.
	<a href="https://www.linkedin.com/in/houzezhang"><b>Linkedin</b></a>.
	</p>
</footer>

</body>
</html>
